<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Font Settings with Live Preview</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url("static/images/image 1.png") no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .wrapper {
      background: rgba(0, 0, 0, 0.4);
      padding: 50px;
      border-radius: 16px;
      display: flex;
      max-width: 1600px;
      width: 100%;
      gap: 20px;
    }

    .form-section {
      flex: 1;
      background: #fff;
      color: #000;
      border-radius: 12px;
      padding: 10px;
      overflow-y: auto;
      max-height: 80vh;
    }

    .form-section h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 30px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 6px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 6px;
    }

    select, input[type="number"], input[type="color"] {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .preview-section {
      flex: 1;
      background: #fff;
      border-radius: 12px;
      padding: 10px;
      text-align: center;
    }

    .preview-section h3 {
      margin-bottom: 10px;
    }

    #templateCanvas {
      width: 100%;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      background: #666;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #888;
      @font-face {
  font-family: 'Caveat';
  src: url('/static/fonts/Caveat-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900; /* variable font weight range */
  font-style: normal;
}

@font-face {
  font-family: 'Dancing Script';
  src: url('/static/fonts/DancingScript-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
}

@font-face {
  font-family: 'Great Vibes';
  src: url('/static/fonts/GreatVibes-Regular.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Oswald';
  src: url('/static/fonts/Oswald-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
}

@font-face {
  font-family: 'Pacifico';
  src: url('/static/fonts/Pacifico-Regular.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Playfair Display';
  src: url('/static/fonts/PlayfairDisplay-Italic-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: italic;
}

@font-face {
  font-family: 'Poppins';
  src: url('/static/fonts/Poppins-Regular.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Poppins';
  src: url('/static/fonts/Poppins-Bold.ttf') format('truetype');
  font-weight: 700;
  font-style: normal;
}

@font-face {
  font-family: 'Poppins';
  src: url('/static/fonts/Poppins-Italic.ttf') format('truetype');
  font-weight: 400;
  font-style: italic;
}

@font-face {
  font-family: 'Raleway';
  src: url('/static/fonts/Raleway-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
}

@font-face {
  font-family: 'Raleway';
  src: url('/static/fonts/Raleway-Italic-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: italic;
}

@font-face {
  font-family: 'Roboto';
  src: url('/static/fonts/Roboto-VariableFont_wdth,wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
}

    }
  </style>
  <!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Caveat&family=Dancing+Script&family=Great+Vibes&family=Pacifico&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Poppins:wght@400;700&family=Raleway:wght@400;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

</head>
<body>

  <form method="POST" id="fontForm">
    {% csrf_token %}
    <div class="wrapper">

      <!-- Left Side: Dynamic Font Controls -->
      <div class="form-section">
        <h2>üñäÔ∏è Font Settings for Each Field</h2>
        {% for field in fields %}
          <div class="form-group" data-field="{{ field }}">
            <label><strong>{{ field }}</strong></label>

              <label>Font Style:</label>
              <select name="{{ field }}_font" class="font-select" data-field="{{ field }}">
                <option value="Roboto" selected>Roboto</option>
                <option value="Playfair Display">Playfair Display</option>
                <option value="Pacifico">Pacifico</option>
                <option value="Caveat">Caveat</option>
                <option value="Great Vibes">Great Vibes</option>
                <option value="Raleway">Raleway</option>
                <option value="Poppins">Poppins</option>
                <option value="Dancing Script">Dancing Script</option>
                <option value="Oswald">Oswald</option>
              </select>
              <div style="margin-top:10px;">
                <label><input type="checkbox" class="bold-toggle" data-field="{{ field }}"> Bold</label>
                <label><input type="checkbox" class="italic-toggle" data-field="{{ field }}"> Italic</label>
              </div>



            <label>Font Size:</label>
            <input type="number" name="{{ field }}_size" class="size-input" data-field="{{ field }}" value="40" min="10" max="100">

            <label>Font Color:</label>
            <input type="color" name="{{ field }}_color" class="color-input" data-field="{{ field }}" value="#000000">
          </div>
        {% endfor %}
        <button type="submit">Finalize and Generate</button>
      </div>

      <!-- Right Side: Canvas Preview -->
      <div class="preview-section">
        <h3>Live Preview</h3>
        <canvas id="templateCanvas"></canvas>
      </div>

    </div>
  </form>

  <script>
    const fields = {{ fields|safe }};
    const coordinates = {{ coordinates|safe }};
    const templateUrl = "{{ template_url }}";

    const canvas = document.getElementById('templateCanvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

  const fontSettings = {};
  fields.forEach(field => {
    const font = document.querySelector(`select.font-select[data-field="${field}"]`).value;
    const size = Number(document.querySelector(`input.size-input[data-field="${field}"]`).value);
    const color = document.querySelector(`input.color-input[data-field="${field}"]`).value;
    const bold = document.querySelector(`.bold-toggle[data-field="${field}"]`).checked;
    const italic = document.querySelector(`.italic-toggle[data-field="${field}"]`).checked;

    fontSettings[field] = { font, size, color, bold, italic };
  });

  function initializeFontSettings() {
  fields.forEach(field => {
    const fontInput = document.querySelector(`select.font-select[data-field="${field}"]`);
    const sizeInput = document.querySelector(`input.size-input[data-field="${field}"]`);
    const colorInput = document.querySelector(`input.color-input[data-field="${field}"]`);
    const boldInput = document.querySelector(`.bold-toggle[data-field="${field}"]`);
    const italicInput = document.querySelector(`.italic-toggle[data-field="${field}"]`);

    if (!fontInput.value) fontInput.value = 'Roboto';
    if (!sizeInput.value || isNaN(sizeInput.value)) sizeInput.value = 40;
    if (!colorInput.value) colorInput.value = '#000000';
    if (boldInput.checked === undefined) boldInput.checked = false;
    if (italicInput.checked === undefined) italicInput.checked = false;

    fontSettings[field] = {
      font: fontInput.value || 'Roboto',
      size: Number(sizeInput.value) || 40,
      color: colorInput.value || '#000000',
      bold: boldInput.checked || false,
      italic: italicInput.checked || false,
    };
  });
}

initializeFontSettings();


document.fonts.ready.then(() => {
  drawPreview();
});



    img.onload = () => {
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      drawPreview();
    };
    img.src = templateUrl;

    function drawPreview() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);

      fields.forEach(field => {
        const coord = coordinates[field];
        if (!coord) return;

        const { font, size, color, bold, italic } = fontSettings[field];
        let weight = bold ? '700' : '400';
        let style = italic ? 'italic' : 'normal';
        let cssFont=font;
        // if (font === 'times.ttf') cssFont = 'Times New Roman';
        // else if (font === 'calibri.ttf') cssFont = 'Calibri';

        ctx.font = `${italic ? 'italic ' : ''}${bold ? 'bold ' : ''}${size}px '${cssFont}'`;

        ctx.fillStyle = color;
        ctx.fillText(field, coord.x, coord.y);
      });
    }

    document.querySelectorAll('.font-select').forEach(select => {
      select.addEventListener('change', e => {
        const field = e.target.dataset.field;
        fontSettings[field].font = e.target.value;
        drawPreview();
      });
    });

    document.querySelectorAll('.size-input').forEach(input => {
      input.addEventListener('input', e => {
        const field = e.target.dataset.field;
        fontSettings[field].size = Number(e.target.value) || 40;
        drawPreview();
      });
    });

    document.querySelectorAll('.color-input').forEach(input => {
      input.addEventListener('input', e => {
        const field = e.target.dataset.field;
        fontSettings[field].color = e.target.value;
        drawPreview();
      });
    });

    document.querySelectorAll('.bold-toggle').forEach(input => {
      input.addEventListener('change', e => {
        const field = e.target.dataset.field;
        fontSettings[field].bold = e.target.checked;
        drawPreview();
      });
    });

    document.querySelectorAll('.italic-toggle').forEach(input => {
      input.addEventListener('change', e => {
        const field = e.target.dataset.field;
        fontSettings[field].italic = e.target.checked;
        drawPreview();
      });
    });
    document.querySelectorAll('.form-group').forEach(group => {
      const field = group.dataset.field;

      const font = group.querySelector('.font-select')?.value || 'Roboto';
      const size = parseInt(group.querySelector('.size-input')?.value) || 40;
      const color = group.querySelector('.color-input')?.value || '#000000';
      const bold = group.querySelector('.bold-toggle')?.checked || false;
      const italic = group.querySelector('.italic-toggle')?.checked || false;

      fontSettings[field] = {
        font,
        size,
        color,
        bold,
        italic
      };
    });


  </script>

</body>
</html>
